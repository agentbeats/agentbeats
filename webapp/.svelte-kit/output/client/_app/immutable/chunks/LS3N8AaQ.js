import"./CWj6FrbW.js";import{i as Dt}from"./_pPX3X5k.js";import{o as jt,a as Bt}from"./B-G1-8zH.js";import{p as ct,f as c,c as n,ay as Mt,az as Nt,r as s,a as o,b as ut,j as y,m as E,i as t,l as nt,d as M,n as ot,t as lt,s as _,k as L,q as b,x as f}from"./D_E79TID.js";import{i as z}from"./D0mllNP8.js";import{e as Ft,i as Et}from"./CqRAOBwW.js";import{a as Lt,c as Ut,s as qt}from"./eloSdJH1.js";import{s as Zt}from"./BMrKUOY7.js";import{p as vt,r as zt,b as Gt}from"./gMceMjmh.js";import{C as X,a as Y,b as it,c as dt}from"./B6GxE72l.js";import{g as ft}from"./BbsVzjoZ.js";var Ht=c("<div><!></div>");function Ot(G,h){ct(h,!0);let U=vt(h,"ref",15,null),e=zt(h,["$$slots","$$events","$$legacy","ref","class","children"]);var x=Ht();Lt(x,l=>({"data-slot":"card-footer",class:l,...e}),[()=>Ut("[.border-t]:pt-6 flex items-center px-6",h.class)]);var I=n(x);Mt(I,()=>h.children??Nt),s(x),Gt(x,l=>U(l),()=>U()),o(G,x),ut()}var St=c('<div class="animate-pulse text-muted-foreground">Please waitâ€¦</div>'),Tt=c("<!> <!>",1),Wt=c('<div class="text-destructive"> </div>'),Jt=c("<!> <!>",1),Kt=c('<span class="text-xs text-muted-foreground"> </span>'),Qt=c('<li class="flex flex-col gap-0.5"><span><span class="text-xs text-muted-foreground"> </span> <!></span></li>'),Rt=c('<div class="mt-3"><span class="text-xs text-muted-foreground">Opponents:</span> <ul class="ml-4 mt-2 list-disc space-y-1"></ul></div>'),Vt=c('<div class="mt-2"><span class="text-xs text-muted-foreground">No opponents found</span></div>'),Xt=c('<div class="flex flex-row items-center justify-between w-full gap-1 mt-3"><div class="flex flex-col items-start gap-2"><span class="font-bold text-sm"> </span> <span class="text-xs text-muted-foreground font-mono select-all"> </span> <span class="text-xs text-muted-foreground">Host / Green Agent</span> <!></div> <div class="flex flex-col items-end gap-1"><span class="text-xs font-mono text-muted-foreground select-all"> </span> <span class="text-xs text-muted-foreground"> </span></div></div>'),Yt=c('<div class="flex flex-row items-center gap-3"><span> </span></div> <span class="text-[10px] text-muted-foreground font-mono select-all"> </span>',1),te=c("<!> <!>",1);function ue(G,h){ct(h,!1);let U=vt(h,"battleId",8),e=E(null),x=E(!0),I=E(null),l=E(null),C=E([]),H=null;function pt(a){return a?a.slice(0,8):""}function mt(a){if(!a)return"N/A";let i=a;return a&&!a.endsWith("Z")&&(i=a+"Z"),new Date(i).toLocaleString()}function _t(a){switch((a||"").toLowerCase()){case"pending":return"text-yellow-600";case"queued":return"text-yellow-600";case"running":return"text-blue-600";default:return"text-muted-foreground"}}function xt(a){if(!a)return"";const i=new Date(a).getTime(),u=Date.now();if(isNaN(i))return"";let r=Math.round((u-i)/1e3);return r<0&&(r=0),r<60?`${r}s`:r<3600?`${Math.floor(r/60)}m ${r%60}s`:`${Math.floor(r/3600)}h ${Math.floor(r%3600/60)}m`}jt(async()=>{var a,i;y(x,!0),y(I,null);try{const u=await fetch(`/api/battles/${U()}`);if(!u.ok)throw new Error("Failed to fetch battle");if(y(e,await u.json()),t(e).green_agent_id||t(e).greenAgentId)try{y(l,await ft(t(e).green_agent_id||t(e).greenAgentId))}catch{y(l,null)}if(y(C,[]),Array.isArray(t(e).opponents))for(const r of t(e).opponents){let A=typeof r=="object"&&r.agent_id?r.agent_id:typeof r=="string"?r:null,v=typeof r=="object"&&r.name?r.name:"";if(A)try{const p=await ft(A);t(C).push({name:((a=p.register_info)==null?void 0:a.name)||((i=p.agent_card)==null?void 0:i.name)||"Unknown",role:v})}catch{t(C).push({name:"Unknown",role:v})}}tt(),H=setInterval(tt,1e3)}catch(u){y(I,u instanceof Error?u.message:"Failed to load battle")}finally{y(x,!1)}}),Bt(()=>{H&&clearInterval(H)});function tt(){t(e)&&(t(e).created_at||t(e).createdAt)&&xt(t(e).created_at||t(e).createdAt)}Dt();var et=nt(),gt=M(et);{var $t=a=>{X(a,{class:"w-full max-w-4xl border shadow-sm bg-background my-4 px-6 py-4",children:(i,u)=>{var r=Tt(),A=M(r);Y(A,{children:(p,O)=>{it(p,{children:(g,D)=>{ot();var N=lt("Loading battle...");o(g,N)},$$slots:{default:!0}})},$$slots:{default:!0}});var v=_(A,2);dt(v,{children:(p,O)=>{var g=St();o(p,g)},$$slots:{default:!0}}),o(i,r)},$$slots:{default:!0}})},bt=a=>{var i=nt(),u=M(i);{var r=v=>{X(v,{class:"w-full max-w-4xl border shadow-sm bg-background my-4 px-6 py-4",children:(p,O)=>{var g=Jt(),D=M(g);Y(D,{children:(P,S)=>{it(P,{children:(d,m)=>{ot();var $=lt("Error loading battle");o(d,$)},$$slots:{default:!0}})},$$slots:{default:!0}});var N=_(D,2);dt(N,{children:(P,S)=>{var d=Wt(),m=n(d,!0);s(d),L(()=>b(m,t(I))),o(P,d)},$$slots:{default:!0}}),o(p,g)},$$slots:{default:!0}})},A=v=>{X(v,{class:"w-full max-w-4xl border shadow-sm bg-background my-4 px-6 py-4",children:(p,O)=>{var g=te(),D=M(g);Y(D,{class:"pb-2 px-2",children:(P,S)=>{var d=Xt(),m=n(d),$=n(m),T=n($,!0);s($);var j=_($,2),W=n(j,!0);s(j);var J=_(j,4);{var ht=w=>{var k=Rt(),F=_(n(k),2);Ft(F,5,()=>t(C),Et,(Z,B)=>{var K=Qt(),st=n(K),Q=n(st),Pt=n(Q,!0);s(Q);var kt=_(Q,2);{var It=R=>{var V=Kt(),Ct=n(V);s(V),L(()=>b(Ct,`(${t(B),f(()=>t(B).role)??""})`)),o(R,V)};z(kt,R=>{t(B),f(()=>t(B).role)&&R(It)})}s(st),s(K),L(()=>b(Pt,(t(B),f(()=>t(B).name)))),o(Z,K)}),s(F),s(k),o(w,k)},wt=w=>{var k=Vt();o(w,k)};z(J,w=>{t(C),f(()=>t(C).length>0)?w(ht):w(wt,!1)})}s(m);var at=_(m,2),q=n(at),yt=n(q);s(q);var rt=_(q,2),At=n(rt,!0);s(rt),s(at),s(d),L((w,k)=>{b(T,(t(l),f(()=>{var F,Z;return t(l)?((F=t(l).register_info)==null?void 0:F.name)||((Z=t(l).agent_card)==null?void 0:Z.name)||"Unknown":"Not Found"}))),b(W,(t(l),t(e),f(()=>t(l)?t(l).agent_id||t(l).id:t(e).green_agent_id||t(e).greenAgentId))),qt(q,"title",(t(e),f(()=>t(e).battle_id||t(e).id))),b(yt,`Battle #${w??""}`),b(At,k)},[()=>(t(e),f(()=>pt(t(e).battle_id||t(e).id))),()=>(t(e),f(()=>mt(t(e).created_at||t(e).createdAt)))]),o(P,d)},$$slots:{default:!0}});var N=_(D,2);Ot(N,{class:"pt-4 flex flex-row items-between justify-between w-full mb-0 px-2",children:(P,S)=>{var d=Yt(),m=M(d),$=n(m),T=n($,!0);s($),s(m);var j=_(m,2),W=n(j);s(j),L(J=>{Zt($,1,`text-xs font-semibold ${J??""}`),b(T,(t(e),f(()=>t(e).state))),b(W,`Battle ID: ${t(e),f(()=>t(e).battle_id||t(e).id)??""}`)},[()=>(t(e),f(()=>_t(t(e).state)))]),o(P,d)},$$slots:{default:!0}}),o(p,g)},$$slots:{default:!0}})};z(u,v=>{t(I)?v(r):v(A,!1)},!0)}o(a,i)};z(gt,a=>{t(x)?a($t):a(bt,!1)})}o(G,et),ut()}export{ue as B,Ot as C};
