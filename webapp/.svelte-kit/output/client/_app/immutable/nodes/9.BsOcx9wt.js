import"../chunks/CWj6FrbW.js";import{i as z}from"../chunks/_pPX3X5k.js";import{o as M}from"../chunks/B-G1-8zH.js";import{a7 as $,b1 as P,S as W,b2 as D,b3 as G,aD as J,x as K,b4 as Q,b5 as R,aQ as U,ap as H,az as w,p as V,f as T,a as A,b as X,s as Y,c as C,i as x,m as Z,r as y,j as tt,e as at}from"../chunks/D_E79TID.js";import{i as rt}from"../chunks/D0mllNP8.js";import{e as et}from"../chunks/CqRAOBwW.js";import{B as it}from"../chunks/LS3N8AaQ.js";import{g as st}from"../chunks/BXNnu7_f.js";const ot=()=>performance.now(),b={tick:a=>requestAnimationFrame(a),now:()=>ot(),tasks:new Set};function q(){const a=b.now();b.tasks.forEach(t=>{t.c(a)||(b.tasks.delete(t),t.f())}),b.tasks.size!==0&&b.tick(q)}function nt(a){let t;return b.tasks.size===0&&b.tick(q),{promise:new Promise(r=>{b.tasks.add(t={c:a,f:r})}),abort(){b.tasks.delete(t)}}}function k(a,t){R(()=>{a.dispatchEvent(new CustomEvent(t))})}function ft(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const t=a.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function L(a){const t={},r=a.split(";");for(const i of r){const[d,v]=i.split(":");if(!d||v===void 0)break;const f=ft(d.trim());t[f]=v.trim()}return t}const ct=a=>a;function lt(a,t,r,i){var d=(a&Q)!==0,v="both",f,m=t.inert,h=t.style.overflow,c,o;function s(){return R(()=>f??(f=r()(t,(i==null?void 0:i())??{},{direction:v})))}var e={is_global:d,in(){t.inert=m,k(t,"introstart"),c=F(t,s(),o,1,()=>{k(t,"introend"),c==null||c.abort(),c=f=void 0,t.style.overflow=h})},out(p){t.inert=!0,k(t,"outrostart"),o=F(t,s(),c,0,()=>{k(t,"outroend"),p==null||p()})},stop:()=>{c==null||c.abort(),o==null||o.abort()}},l=$;if((l.transitions??(l.transitions=[])).push(e),P){var u=d;if(!u){for(var n=l.parent;n&&(n.f&W)!==0;)for(;(n=n.parent)&&(n.f&D)===0;);u=!n||(n.f&G)!==0}u&&J(()=>{K(()=>e.in())})}}function F(a,t,r,i,d){var v=i===1;if(U(t)){var f,m=!1;return H(()=>{if(!m){var p=t({direction:v?"in":"out"});f=F(a,p,r,i,d)}}),{abort:()=>{m=!0,f==null||f.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(r==null||r.deactivate(),!(t!=null&&t.duration))return d(),{abort:w,deactivate:w,reset:w,t:()=>i};const{delay:h=0,css:c,tick:o,easing:s=ct}=t;var e=[];if(v&&r===void 0&&(o&&o(0,1),c)){var l=L(c(0,1));e.push(l,l)}var u=()=>1-i,n=a.animate(e,{duration:h,fill:"forwards"});return n.onfinish=()=>{n.cancel();var p=(r==null?void 0:r.t())??1-i;r==null||r.abort();var E=i-p,_=t.duration*Math.abs(E),N=[];if(_>0){var B=!1;if(c)for(var O=Math.ceil(_/16.666666666666668),S=0;S<=O;S+=1){var j=p+E*s(S/O),I=L(c(j,1-j));N.push(I),B||(B=I.overflow==="hidden")}B&&(a.style.overflow="hidden"),u=()=>{var g=n.currentTime;return p+E*s(g/_)},o&&nt(()=>{if(n.playState!=="running")return!1;var g=u();return o(g,1-g),!0})}n=a.animate(N,{duration:_,fill:"forwards"}),n.onfinish=()=>{u=()=>i,o==null||o(i,1-i),d()}},{abort:()=>{n&&(n.cancel(),n.effect=null,n.onfinish=w)},deactivate:()=>{d=w},reset:()=>{i===0&&(o==null||o(1,0))},t:()=>u()}}const dt=a=>a;function vt(a,{delay:t=0,duration:r=400,easing:i=dt}={}){const d=+getComputedStyle(a).opacity;return{delay:t,duration:r,easing:i,css:v=>`opacity: ${v*d}`}}var ut=T('<button type="button" class="cursor-pointer"><!></button>'),pt=T('<div class="text-center text-muted-foreground mt-10">No ongoing battles found.</div>'),bt=T('<div class="flex flex-1 flex-col items-center justify-center min-h-[80vh]"><div class="w-full max-w-5xl flex flex-col items-center"><div class="grid grid-cols-1 gap-4 px-4 lg:px-6 w-full"></div> <!></div></div>');function Et(a,t){V(t,!1);let r=[],i=Z([]),d=null;function v(){const s=["pending","queued","running"];tt(i,r.filter(e=>s.includes((e.state||"").toLowerCase())))}M(()=>{fetch("/api/battles").then(s=>s.json()).then(s=>{r=s,v()}),d=new WebSocket((window.location.protocol==="https:"?"wss://":"ws://")+window.location.host+"/ws/battles"),d.onmessage=s=>{try{const e=JSON.parse(s.data);if(e&&e.type==="battles_update"&&Array.isArray(e.battles)&&(r=e.battles,v()),e&&e.type==="battle_update"&&e.battle){const l=r.findIndex(u=>u.id===e.battle.id);l!==-1?r[l]=e.battle:r=[e.battle,...r],v()}}catch{}}}),z();var f=bt(),m=C(f),h=C(m);et(h,5,()=>x(i),s=>s.id,(s,e)=>{var l=ut(),u=C(l);it(u,{get battleId(){return x(e).id}}),y(l),at("click",l,()=>st(`/battle/${x(e).id}`)),lt(3,l,()=>vt,()=>({duration:220})),A(s,l)}),y(h);var c=Y(h,2);{var o=s=>{var e=pt();A(s,e)};rt(c,s=>{x(i).length===0&&s(o)})}y(m),y(f),A(a,f),X()}export{Et as component};
